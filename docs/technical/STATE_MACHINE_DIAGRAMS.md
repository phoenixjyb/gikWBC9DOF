# State Machine Visual Flow Diagrams

**Quick Reference**: [`STATE_MACHINE_QUICKREF.md`](STATE_MACHINE_QUICKREF.md)  
**Full Documentation**: [`STATE_MACHINE_ARCHITECTURE.md`](STATE_MACHINE_ARCHITECTURE.md)

---

## Complete System State Machine

```
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘         SYSTEM INITIALIZATION         â•‘
                    â•‘   Parse YAML configuration file       â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                      â”‚
                                      â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  control_mode: "holistic" | "staged"â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                              â”‚
           â•”â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•—         â•”â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•—
           â•‘  HOLISTIC MODE   â•‘         â•‘   STAGED MODE     â•‘
           â•‘  control_mode =  â•‘         â•‘   control_mode =  â•‘
           â•‘  "holistic"      â•‘         â•‘   "staged"        â•‘
           â•šâ•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•         â•šâ•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•
                    â”‚                             â”‚
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚     STAGE A        â”‚
                    â”‚                   â”‚   Arm Ramp-Up      â”‚
                    â”‚                   â”‚  (6-DOF, chassis   â”‚
                    â”‚                   â”‚   frozen at init)  â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â”‚                             â”‚
                    â”‚                    checkArmAtHome()
                    â”‚                      returns TRUE
                    â”‚                             â”‚
                    â”‚                             â–¼
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚     STAGE B         â”‚
                    â”‚                   â”‚  Chassis Planning   â”‚
                    â”‚                   â”‚  (Arm held at home) â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â”‚                     Parse parameter:
                    â”‚                  staged.stage_b.submode
                    â”‚                             â”‚
                    â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚                                  â”‚
                    â”‚      â•”â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•—              â•”â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•—
                    â”‚      â•‘ SUBMODE B1  â•‘              â•‘   SUBMODE B2    â•‘
                    â”‚      â•‘ "pure_      â•‘              â•‘ "gik_assisted"  â•‘
                    â”‚      â•‘  hybrid_    â•‘              â•‘                 â•‘
                    â”‚      â•‘  astar"     â•‘              â•‘  Hybrid A* +    â•‘
                    â”‚      â•‘             â•‘              â•‘  GIK 3-DOF      â•‘
                    â”‚      â•‘ Hybrid A* â†’ â•‘              â•‘  refinement     â•‘
                    â”‚      â•‘ Velocity    â•‘              â•‘                 â•‘
                    â”‚      â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•â•â•              â•šâ•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•
                    â”‚            â”‚                                  â”‚
                    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â”‚                stageBChassisReachedGoal()
                    â”‚                      returns TRUE
                    â”‚                             â”‚
                    â”‚                             â–¼
                    â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚     STAGE C         â”‚
                    â”‚                   â”‚  Whole-Body Trackingâ”‚
                    â”‚                   â”‚  (9-DOF GIK)        â”‚
                    â”‚                   â”‚  = Holistic Control â”‚
                    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘   9-DOF GIK SOLVER        â•‘
                        â•‘   (MATLAB Codegen)        â•‘
                        â•‘   Solves for q (9-DOF)    â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  velocity_control_mode       â”‚
                        â”‚  0 | 1 | 2                   â”‚
                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                  â”‚                  â”‚
     â•”â•â•â•â•â•â–¼â•â•â•â•â•â•—    â•”â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•—   â•”â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•—
     â•‘  MODE 0   â•‘    â•‘   MODE 1     â•‘   â•‘   MODE 2    â•‘
     â•‘  Legacy   â•‘    â•‘   Heading    â•‘   â•‘ Pure Pursuitâ•‘
     â•‘  5-point  â•‘    â•‘  Controller  â•‘   â•‘ (RECOMMEND) â•‘
     â•‘   diff    â•‘    â•‘   P + FF     â•‘   â•‘  Lookahead  â•‘
     â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•    â•šâ•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•   â•šâ•â•â•â•â•â•â•¤â•â•â•â•â•â•â•
           â”‚                  â”‚                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                  â•‘  WHEEL VELOCITIES     â•‘
                  â•‘  (vL, vR)             â•‘
                  â•‘  Published to robot   â•‘
                  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Stage A Detailed Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              STAGE A: ARM RAMP-UP                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Initialize Stage A           â”‚
        â”‚  â€¢ Set target = arm home      â”‚
        â”‚  â€¢ Freeze chassis (vL=vR=0)   â”‚
        â”‚  â€¢ Start timeout timer        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Control Loop (10 Hz)         â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Solve 6-DOF IK               â”‚
        â”‚  (Arm only, chassis fixed)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Check arm position           â”‚
        â”‚  checkArmAtHome():            â”‚
        â”‚  â€¢ Compare joints 3-8         â”‚
        â”‚  â€¢ Tolerance: 0.1 rad         â”‚
        â”‚  â€¢ Target: [0,0,0,0,0,0]      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NOT AT HOME   â”‚        â”‚   AT HOME      â”‚
    â”‚ (>0.1 rad)    â”‚        â”‚   (<0.1 rad)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â”‚                        â–¼
            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚              â”‚ Activate Stage B â”‚
            â”‚              â”‚ Transition to B  â”‚
            â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Check timeout                â”‚
        â”‚  (Default: 10 seconds)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NOT TIMEOUT   â”‚      â”‚   TIMEOUT       â”‚
    â”‚  Continue      â”‚      â”‚   Error/Abort   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stage B Detailed Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           STAGE B: CHASSIS PLANNING                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  stageBActivate()             â”‚
        â”‚  â€¢ Initialize planner         â”‚
        â”‚  â€¢ Set goal pose              â”‚
        â”‚  â€¢ Start timeout timer        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  Control Loop (10 Hz)         â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  stageBExecuteStep()          â”‚
        â”‚  â€¢ Plan path (Hybrid A*)      â”‚
        â”‚  â€¢ Track path (velocity ctrl) â”‚
        â”‚  â€¢ Hold arm at home           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  stageBChassisReachedGoal()   â”‚
        â”‚  â€¢ Check XY distance          â”‚
        â”‚  â€¢ Check heading error        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NOT AT GOAL   â”‚       â”‚   AT GOAL       â”‚
    â”‚  (>tolerance)  â”‚       â”‚   (<tolerance)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â”‚                        â–¼
            â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚              â”‚ stageBDeactivate()  â”‚
            â”‚              â”‚ Transition to       â”‚
            â”‚              â”‚ STAGE C             â”‚
            â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Check timeout                â”‚
        â”‚  (Default: 30 seconds)        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  NOT TIMEOUT   â”‚      â”‚   TIMEOUT       â”‚
    â”‚  Continue      â”‚      â”‚   Replan/Abort  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Stage B Submode Decision

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      STAGE B SUBMODE SELECTION                       â•‘
â•‘      staged.stage_b.submode parameter                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SUBMODE B1     â”‚      â”‚  SUBMODE B2      â”‚
    â”‚ "pure_hybrid_   â”‚      â”‚ "gik_assisted"   â”‚
    â”‚  astar"         â”‚      â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â–¼                        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   B1 PIPELINE         â•‘  â•‘   B2 PIPELINE         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                       â•‘  â•‘                       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ Hybrid A*       â”‚ â•‘  â•‘  â”‚ Hybrid A*       â”‚ â•‘
â•‘  â”‚ Path Planner    â”‚ â•‘  â•‘  â”‚ Coarse Planner  â”‚ â•‘
â•‘  â”‚                 â”‚ â•‘  â•‘  â”‚                 â”‚ â•‘
â•‘  â”‚ â€¢ Grid-based    â”‚ â•‘  â•‘  â”‚ â€¢ Grid-based    â”‚ â•‘
â•‘  â”‚ â€¢ A* search     â”‚ â•‘  â•‘  â”‚ â€¢ Obstacles     â”‚ â•‘
â•‘  â”‚ â€¢ Obstacle map  â”‚ â•‘  â•‘  â”‚                 â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘           â”‚          â•‘  â•‘           â”‚          â•‘
â•‘           â–¼          â•‘  â•‘           â–¼          â•‘
â•‘  Path Waypoints     â•‘  â•‘  Coarse Waypoints   â•‘
â•‘           â”‚          â•‘  â•‘           â”‚          â•‘
â•‘           â”‚          â•‘  â•‘           â–¼          â•‘
â•‘           â”‚          â•‘  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘           â”‚          â•‘  â•‘  â”‚ GIK 3-DOF       â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â”‚ Solver          â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â”‚                 â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â”‚ â€¢ Chassis-only  â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â”‚ â€¢ Constraints   â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â”‚ â€¢ Refinement    â”‚ â•‘
â•‘           â”‚          â•‘  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘           â”‚          â•‘  â•‘           â”‚          â•‘
â•‘           â”‚          â•‘  â•‘           â–¼          â•‘
â•‘           â”‚          â•‘  â•‘  Refined Config     â•‘
â•‘           â”‚          â•‘  â•‘  q (x, y, Î¸)        â•‘
â•‘           â”‚          â•‘  â•‘           â”‚          â•‘
â•‘           â–¼          â•‘  â•‘           â–¼          â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ Velocity        â”‚ â•‘  â•‘  â”‚ Velocity        â”‚ â•‘
â•‘  â”‚ Controller      â”‚ â•‘  â•‘  â”‚ Controller      â”‚ â•‘
â•‘  â”‚                 â”‚ â•‘  â•‘  â”‚                 â”‚ â•‘
â•‘  â”‚ Mode: 0 | 1 | 2 â”‚ â•‘  â•‘  â”‚ Mode: 0 | 1 | 2 â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘           â”‚          â•‘  â•‘           â”‚          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘ Wheel Velocities   â•‘
          â•‘ (vL, vR)           â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Velocity Controller Selection

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      VELOCITY CONTROLLER SELECTION                   â•‘
â•‘      velocity_control_mode: 0 | 1 | 2                â•‘
â•‘      (Shared by ALL control modes)                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MODE 0     â”‚ â”‚   MODE 1    â”‚ â”‚   MODE 2      â”‚
â”‚   Legacy     â”‚ â”‚  Heading    â”‚ â”‚ Pure Pursuit  â”‚
â”‚   5-Point    â”‚ â”‚ Controller  â”‚ â”‚ (RECOMMENDED) â”‚
â”‚   Diff       â”‚ â”‚             â”‚ â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ Numerical     â•‘ â•‘ Proportionalâ•‘ â•‘ Geometric     â•‘
â•‘ Diff:         â•‘ â•‘ Control:    â•‘ â•‘ Lookahead:    â•‘
â•‘               â•‘ â•‘             â•‘ â•‘               â•‘
â•‘ dq/dt â‰ˆ       â•‘ â•‘ vx = vx_cmd â•‘ â•‘ L = base +    â•‘
â•‘ f(q[k-2:k+2]) â•‘ â•‘ wz = Kp*err â•‘ â•‘     K_v*|v|   â•‘
â•‘               â•‘ â•‘    + Kff*wz â•‘ â•‘               â•‘
â•‘               â•‘ â•‘             â•‘ â•‘ Îº = 2sin(Î±)/L â•‘
â•‘ âŒ Noisy      â•‘ â•‘ âœ… Simple   â•‘ â•‘ Ï‰ = v * Îº     â•‘
â•‘ âŒ Sensitive  â•‘ â•‘ âš ï¸ No path  â•‘ â•‘               â•‘
â•‘               â•‘ â•‘    tracking â•‘ â•‘ âœ… Smooth     â•‘
â•‘               â•‘ â•‘             â•‘ â•‘ âœ… Adaptive   â•‘
â•‘               â•‘ â•‘             â•‘ â•‘ âœ… Bidirect.  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Differential Drive Kinematicsâ”‚
        â”‚  vL = (2*vx - w*track)/2      â”‚
        â”‚  vR = (2*vx + w*track)/2      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
              â•‘ Wheel Velocitiesâ•‘
              â•‘ (vL, vR)        â•‘
              â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Parameter Configuration Flow

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  gik9dof_solver.yaml (Configuration File)             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ control_mode  â”‚ â”‚ velocity_   â”‚ â”‚ staged.stage_b.  â”‚
â”‚ "holistic" |  â”‚ â”‚ control_    â”‚ â”‚ submode          â”‚
â”‚ "staged"      â”‚ â”‚ mode        â”‚ â”‚ "pure_hybrid_    â”‚
â”‚               â”‚ â”‚ 0 | 1 | 2   â”‚ â”‚  astar" |        â”‚
â”‚               â”‚ â”‚             â”‚ â”‚ "gik_assisted"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                 â”‚
        â–¼                â–¼                 â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  GIK9DOFSolverNode::constructor()                     â•‘
â•‘  â€¢ this->get_parameter("control_mode")                â•‘
â•‘  â€¢ this->get_parameter("velocity_control_mode")       â•‘
â•‘  â€¢ this->get_parameter("staged.stage_b.submode")      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Initialization:                                      â”‚
â”‚  â€¢ control_mode_ = (str == "staged") ? STAGED         â”‚
â”‚                                      : HOLISTIC       â”‚
â”‚  â€¢ current_stage_ = STAGE_A  (if STAGED)              â”‚
â”‚  â€¢ velocity_control_mode_ = int value (0/1/2)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Runtime Control Loop (10 Hz)                         â•‘
â•‘  â€¢ Uses control_mode_ to switch behavior              â•‘
â•‘  â€¢ Uses current_stage_ to track progress              â•‘
â•‘  â€¢ Uses velocity_control_mode_ for path tracking      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Legend

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—   Double-line box = Major state/component
â•‘  TITLE     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Single-line box = Function/process
â”‚  Process   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”‚          Solid arrow = Control flow
      â–¼

     â”€â”€â–¶         Dashed arrow = Data flow

```

---

**See Also**:
- ğŸ“– [Full State Machine Documentation](STATE_MACHINE_ARCHITECTURE.md)
- ğŸš€ [Quick Reference](STATE_MACHINE_QUICKREF.md)
- âš™ï¸ [Configuration File](../../ros2/gik9dof_solver/config/gik9dof_solver.yaml)
