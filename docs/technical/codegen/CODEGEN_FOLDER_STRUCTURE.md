# Codegen Folder Structure Explained

**Purpose:** This document explains the `codegen/` directory structure and what each folder contains.

**Last Updated:** October 10, 2025

---

## ğŸ“ Directory Overview

```
codegen/
â”œâ”€â”€ arm64_realtime/          âœ… REQUIRED - Main GIK solver
â”œâ”€â”€ planner_arm64/           âœ… REQUIRED - Path planner  
â”œâ”€â”€ trajectory_smoothing/    âœ… REQUIRED - Trajectory smoothing
â”œâ”€â”€ velocity_smoothing/      âœ… REQUIRED - Velocity smoothing
â”œâ”€â”€ archive/                 âš ï¸  KEEP - Historical versions
â”œâ”€â”€ planner_arm64_backup_*/  âŒ CAN DELETE - Dated backups
```

---

## âœ… Required Folders (Keep Always)

### 1. `arm64_realtime/`
**Purpose:** Main inverse kinematics (IK) solver with real-time constraints  
**Source:** `matlab/+gik9dof/+codegen_inuse/solveGIKStepWrapper.m`  
**Generated by:** `scripts/codegen/generate_code_arm64.m` or `run_codegen_wsl_versioned.ps1`  
**Key Files:**
- `GIKSolver.cpp/h` - Main solver code
- `*.o` files - ARM64 compiled objects
- `BUILD_INFO.txt` - Version tracking info (if using versioned build)
- `build_info.h` - C++ header with build version

**Used By:** `ros2/gik9dof_solver` ROS2 node (primary solver)

**Regeneration Time:** 5-15 minutes

**Build Command:**
```powershell
.\scripts\codegen\run_codegen_wsl_versioned.ps1
```

---

### 2. `planner_arm64/`
**Purpose:** Hybrid A* path planning for mobile base navigation  
**Source:** `matlab/planners/*.m`  
**Generated by:** `scripts/codegen/generate_code_planner_arm64.m`  
**Key Files:**
- `plannerRRTStar.cpp/h`
- `plannerHybridAStar.cpp/h`
- Various planner support files

**Used By:** Path planning module in ROS2

**Regeneration Time:** 5-10 minutes

**Build Command:**
```powershell
.\scripts\codegen\run_planner_codegen.ps1
```

---

### 3. `trajectory_smoothing/`
**Purpose:** Smooths joint trajectories using quintic splines  
**Source:** `matlab/smoothTrajectoryCommand.m`  
**Generated by:** `scripts/codegen/generate_code_trajectory_smoothing.m`  
**Key Files:**
- `smoothTrajectoryCommand.cpp/h`
- Supporting MATLAB Coder runtime files

**Used By:** Trajectory controller in ROS2

**Regeneration Time:** 2-5 minutes

**Build Command:**
```bash
wsl bash scripts/codegen/run_trajectory_smoothing_codegen.sh
```

---

### 4. `velocity_smoothing/`
**Purpose:** Real-time velocity command smoothing with acceleration limits  
**Source:** `matlab/smoothVelocityCommand.m`  
**Generated by:** `scripts/codegen/generate_code_velocity_smoothing.m`  
**Key Files:**
- `smoothVelocityCommand.cpp/h`
- Supporting MATLAB Coder runtime files

**Used By:** Velocity controller in ROS2 (latest feature!)

**Regeneration Time:** 2-5 minutes

**Build Command:**
```bash
wsl bash scripts/codegen/run_velocity_smoothing_codegen.sh
```

---

## âš ï¸ Keep for Reference

### `archive/`
**Purpose:** Historical versions and alternative implementations  
**Contents:** Different codegen experiments, older versions  
**Status:** KEEP - useful for reference and rollback  
**Size:** Usually small, worth keeping

**Reason to keep:**
- Contains working versions from different development stages
- Useful for comparing changes
- Doesn't take much space
- May contain configurations not in current builds

---

## âŒ Safe to Delete

### `planner_arm64_backup_YYYYMMDD_HHMMSS/`
**Example:**
- `planner_arm64_backup_20251009_132832/`
- `planner_arm64_backup_20251009_132850/`

**Purpose:** Automatic timestamped backups created before regenerating planner  
**Status:** CAN DELETE - These are duplicates

**Why safe to delete:**
1. âœ… Same as active `planner_arm64/` folder
2. âœ… Can be regenerated in 5-10 minutes
3. âœ… Git history preserves all changes
4. âœ… Takes up unnecessary disk space (50-100 MB each)
5. âœ… Clutters folder structure

**How to delete:**
```powershell
# Safe automated cleanup
.\scripts\codegen\cleanup_backups.ps1

# Or manual:
Remove-Item codegen\planner_arm64_backup_* -Recurse -Force
```

---

## ğŸ”„ How They Work Together

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MATLAB Source Code                     â”‚
â”‚ matlab/+gik9dof/, matlab/planners/, matlab/*.m          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ MATLAB Coder (WSL)
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              4 Codegen Folders (ARM64 C++)              â”‚
â”‚  arm64_realtime + planner_arm64 +                       â”‚
â”‚  trajectory_smoothing + velocity_smoothing              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ Copy script
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ROS2 Package Structure                      â”‚
â”‚  ros2/gik9dof_solver/src/{gik,planner,traj,vel}/        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ colcon build
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Single Executable (gik9dof_solver_node)          â”‚
â”‚  Runs on Jetson AGX Orin, links all 4 components        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Typical Sizes

| Folder | Files | Size | Regeneration Time |
|--------|-------|------|-------------------|
| `arm64_realtime/` | 150+ | 50-100 MB | 5-15 min |
| `planner_arm64/` | 80+ | 30-50 MB | 5-10 min |
| `trajectory_smoothing/` | 50+ | 10-20 MB | 2-5 min |
| `velocity_smoothing/` | 50+ | 10-20 MB | 2-5 min |
| `archive/` | varies | 5-10 MB | N/A (keep) |
| **Total (required)** | **350+** | **100-180 MB** | **~20-40 min** |

Backup folders add 50-100 MB each and can be safely deleted.

---

## ğŸ” How to Verify

### Check All Required Folders Exist

```powershell
$required = @(
    "arm64_realtime",
    "planner_arm64", 
    "trajectory_smoothing",
    "velocity_smoothing"
)

foreach ($folder in $required) {
    $path = "codegen\$folder"
    if (Test-Path $path) {
        $files = (Get-ChildItem $path -File -Recurse).Count
        Write-Host "âœ“ $folder ($files files)" -ForegroundColor Green
    } else {
        Write-Host "âœ— $folder MISSING!" -ForegroundColor Red
    }
}
```

### Check for Key Files

```powershell
$keyFiles = @(
    "codegen\arm64_realtime\GIKSolver.cpp",
    "codegen\planner_arm64\plannerRRTStar.cpp",
    "codegen\trajectory_smoothing\smoothTrajectoryCommand.cpp",
    "codegen\velocity_smoothing\smoothVelocityCommand.cpp"
)

foreach ($file in $keyFiles) {
    if (Test-Path $file) {
        $size = (Get-Item $file).Length / 1KB
        Write-Host "âœ“ $file (${size:N0} KB)" -ForegroundColor Green
    } else {
        Write-Host "âœ— $file MISSING!" -ForegroundColor Red
    }
}
```

---

## ğŸ› ï¸ Maintenance

### When to Regenerate

Regenerate a component when:
1. âœ… Source MATLAB code changes
2. âœ… MATLAB Coder settings change  
3. âœ… Target architecture changes
4. âœ… Build verification shows outdated

### Check Build Status

```powershell
# Check if build is current
wsl bash scripts/deployment/check_build_current_wsl.sh
```

### Regenerate All Components

```powershell
# Complete rebuild (20-40 minutes)
.\scripts\codegen\run_codegen_wsl_versioned.ps1
.\scripts\codegen\run_planner_codegen.ps1
wsl bash scripts/codegen/run_trajectory_smoothing_codegen.sh
wsl bash scripts/codegen/run_velocity_smoothing_codegen.sh
```

---

## ğŸš€ Quick Actions

### List All Codegen Folders

```powershell
Get-ChildItem codegen -Directory | Select-Object Name, @{N="Files";E={(Get-ChildItem $_.FullName -Recurse -File).Count}}, @{N="Size(MB)";E={[math]::Round((Get-ChildItem $_.FullName -Recurse -File | Measure-Object Length -Sum).Sum / 1MB, 2)}}
```

### Find Backup Folders

```powershell
Get-ChildItem codegen -Directory -Filter "*backup*" | Select-Object Name, LastWriteTime
```

### Clean Up Backups

```powershell
.\scripts\codegen\cleanup_backups.ps1
```

---

## ğŸ“š Related Documentation

- **[docs/guides/COMPLETE_BUILD_GUIDE.md](../../docs/guides/COMPLETE_BUILD_GUIDE.md)** - Complete build tutorial
- **[docs/guides/WSL_BUILD_VERSIONING.md](../../docs/guides/WSL_BUILD_VERSIONING.md)** - Build versioning
- **[scripts/README.md](../../scripts/README.md)** - Scripts reference
- **[docs/technical/codegen/CODEGEN_AUDIT.md](../../docs/technical/codegen/CODEGEN_AUDIT.md)** - Codegen analysis

---

## âœ… Summary

**4 Required Folders** = Complete System:
1. âœ… `arm64_realtime/` - Main IK solver
2. âœ… `planner_arm64/` - Path planning
3. âœ… `trajectory_smoothing/` - Trajectory control
4. âœ… `velocity_smoothing/` - Velocity control

**Keep:**
- âš ï¸  `archive/` - Historical reference

**Safe to Delete:**
- âŒ `planner_arm64_backup_*/` - Dated backups

**Total Build Time:** ~20-40 minutes for all components

**Clean Up Command:**
```powershell
.\scripts\codegen\cleanup_backups.ps1
```
